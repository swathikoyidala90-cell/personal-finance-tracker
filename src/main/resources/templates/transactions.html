<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User Transactions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #0e1117;
            color: #eaeaea;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }

        h1, h3, h5 {
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        h2 {
            color: #d4af37;
            text-align: center;
            margin-bottom: 20px;
        }

        .card {
            background: linear-gradient(145deg, #1a1f29, #11151c);
            border: none;
            color: #f0f0f0;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
        }

        .card-header {
            background-color: #1c1f2a;
            border-bottom: 1px solid #2a2f3a;
        }

        .table {
            color: #eaeaea;
            background-color: #1b1f28;
            border-radius: 10px;
            overflow: hidden;
        }

        .table thead {
            background-color: #232a35;
            color: #d4af37;
        }

        .table-striped > tbody > tr:nth-of-type(odd) {
            background-color: #141821;
        }

        .btn {
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: #d4af37;
            border: none;
            color: #0e1117;
        }

        .btn-primary:hover {
            background-color: #b9962e;
            color: white;
        }

        .btn-outline-primary {
            border-color: #d4af37;
            color: #d4af37;
        }

        .btn-outline-primary:hover {
            background-color: #d4af37;
            color: #0e1117;
        }

        .btn-outline-danger {
            border-color: #e63946;
            color: #e63946;
        }

        .btn-outline-danger:hover {
            background-color: #e63946;
            color: #fff;
        }

        .btn-warning {
            background-color: #6c63ff;
            border: none;
            color: white;
        }

        .btn-warning:hover {
            background-color: #5848e6;
        }

        #incomeExpenseChart {
            max-width: 320px;
            max-height: 320px;
            margin: 30px auto;
        }

        select, input {
            background-color: #1b1f28;
            color: #eaeaea;
            border: 1px solid #2b2f3a;
            border-radius: 8px;
        }

        select:focus, input:focus {
            border-color: #d4af37;
            box-shadow: 0 0 0 0.2rem rgba(212, 175, 55, 0.25);
        }

        hr {
            border-color: #2b2f3a;
        }

        .btn-dashboard {
            background-color: transparent;
            border: 1px solid #d4af37;
            color: #d4af37;
            transition: 0.3s;
        }

        .btn-dashboard:hover {
            background-color: #d4af37;
            color: #0e1117;
        }
    </style>
</head>

<body class="p-4">
<div class="container">
    <h2>üí∞ User Transactions</h2>

    <!-- üü° Navigation Buttons -->
    <div class="text-center mb-4">
        <a href="/dashboard" class="btn btn-dashboard me-2">‚Üê Back to Dashboard</a>
        
    </div>

    <!-- üü¢ Summary Cards -->
    <div class="row mb-4 text-center">
        <div class="col-md-4">
            <div class="card p-3 shadow-sm">
                <h5>Total Income</h5>
                <h3 style="color: #4cd137;" th:text="${totalIncome}"></h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-3 shadow-sm">
                <h5>Total Expense</h5>
                <h3 style="color: #e63946;" th:text="${totalExpense}"></h3>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card p-3 shadow-sm">
                <h5>Balance</h5>
                <h3 style="color: #d4af37;" th:text="${balance}"></h3>
            </div>
        </div>
    </div>

    <!-- üü£ Income vs Expense Chart -->
    <div class="card shadow-sm mb-5">
        <div class="card-header text-center">
            <h5 class="mb-0 text-light">Income vs Expense</h5>
        </div>
        <div class="card-body text-center">
            <canvas id="incomeExpenseChart"></canvas>
        </div>
    </div>

    <!-- üßæ Transactions Table -->
    <h3 class="mb-3 text-light">All Transactions</h3>
    <table class="table table-striped table-hover shadow-sm">
        <thead>
        <tr>
            <th>ID</th>
            <th>Category</th>
            <th>Amount</th>
            <th>Type</th>
            <th>Date</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="tx : ${transactions}">
            <td th:text="${tx.id}"></td>
            <td th:text="${tx.category}"></td>
            <td th:text="${tx.amount}"></td>
            <td>
                <span th:text="${tx.type}"
                      th:classappend="${tx.type == 'income'} ? 'badge bg-success' : 'badge bg-danger'"></span>
            </td>
            <td th:text="${tx.date}"></td>
            <td>
                <a th:href="@{/transactions/edit/{id}(id=${tx.id})}" class="btn btn-sm btn-outline-primary me-2">Edit</a>
                <a th:href="@{/transactions/delete/{id}(id=${tx.id})}"
                   class="btn btn-sm btn-outline-danger"
                   onclick="return confirm('Are you sure you want to delete this transaction?')">Delete</a>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- üü© Add Transaction Form -->
    <hr>
    <h3 class="mt-4 text-light">Add New Transaction</h3>
    <form th:action="@{transactions/add}" method="post">
        <label>User:</label>
        <select name="userId" required>
            <option value="" disabled selected>Select user</option>
            <option th:each="u : ${users}" th:value="${u.id}" th:text="${u.username}"></option>
        </select>

        <label>Category:</label>
        <input type="text" name="category" required>

        <label>Amount:</label>
        <input type="number" name="amount" step="0.01" required>

        <label>Type:</label>
        <select name="type" required>
            <option value="income">Income</option>
            <option value="expense">Expense</option>
        </select>

        <label>Date:</label>
        <input type="date" name="date" required>

        <button type="submit">Add Transaction</button>
    </form>

</div>

<!-- üß† Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    const income = /*[[${totalIncome}]]*/ 0;
    const expense = /*[[${totalExpense}]]*/ 0;

    const ctx = document.getElementById('incomeExpenseChart');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Income', 'Expense'],
            datasets: [{
                data: [income, expense],
                backgroundColor: ['#4cd137', '#e63946'],
                borderColor: ['#2e8b57', '#8b0000'],
                borderWidth: 1.5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: { position: 'bottom', labels: { color: '#eaeaea' } },
                title: { display: false }
            }
        }
    });
    /*]]>*/
</script>
</body>
</html>